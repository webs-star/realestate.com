<!DOCTYPE html>
<html>
<head>
  <title>Real Estate Marketplace</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google-site-verification" content="ZuK2pvozDS96vm0_IRjSYEsTqSdC8FJCIgJdAitGf0U" />
  <meta name="description" content="Use the RealPlot customer map to discover land and rental properties in Kenya. Apply filters and get voice-guided directions instantly." />
  <meta name="keywords" content="real estate Kenya, land map Kenya, property listings, rentals, voice directions, RealPlot Connect, property map" />
  <meta name="author" content="RealPlot Connect by Webs Star" />
  <meta name="robots" content="index, follow" />
  <meta property="og:title" content="RealPlot Connect ‚Äì Customer Property Finder" />
  <meta property="og:description" content="Discover land, rentals, and houses near you using RealPlot‚Äôs live map. Voice-guided directions and filtering included." />
  <meta property="og:url" content="https://webs-star.github.io/realestate.com/customers.html" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://your-site-preview-image.jpg" />
  <link rel="icon" href="favicon.ico" />

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.min.js"></script>

  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; }
    h2 {
      text-align: center;
      background: #0056b3;
      color: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .card, .filters {
      background: white; padding: 20px; border-radius: 8px;
      box-shadow: 0 2px 6px #ccc; max-width: 800px; margin: 20px auto;
    }
    input, select, button {
      width: 100%; margin-top: 10px; padding: 10px;
    }
    img.property {
      width: 100%; margin-bottom: 10px; border-radius: 10px;
    }
    #listings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 10px;
    }
    .card button {
      margin-top: 10px;
      width: 100%;
    }
  </style>
</head>
<body>

<div class="filters">
  <h3>üîç Filter Listings</h3>
  <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:center;">
    <select id="filterType">
      <option value="">All Types</option>
      <option value="land">Land / Plots</option>
      <option value="house">House</option>
      <option value="apartment">Apartment / Flat</option>
      <option value="bungalow">Bungalow</option>
      <option value="maisonette">Maisonette</option>
      <option value="bedsitter">Bedsitter</option>
      <option value="single room">Single Room</option>
      <option value="shop">Shop / Stall</option>
      <option value="office">Office Space</option>
      <option value="godown">Godown / Warehouse</option>
      <option value="commercial building">Commercial Building</option>
      <option value="leased">Leased Property</option>
      <option value="rental">Rental Unit</option>
      <option value="hostel">Student Hostel</option>
      <option value="farm">Farm Land</option>
      <option value="vacant land">Vacant Land</option>
      <option value="industrial">Industrial Property</option>
      <option value="resort">Resort / Hotel</option>
    </select>
    <select id="filterLocation">
      <option value="">All Counties</option>
      <option value="Mombasa">Mombasa</option><option value="Kwale">Kwale</option> <!-- truncated for brevity -->
      <option value="Nairobi">Nairobi</option>
    </select>
    <input type="number" id="minPrice" placeholder="Min KES" />
    <input type="number" id="maxPrice" placeholder="Max KES" />
    <button onclick="loadListings()">Apply Filters</button>
  </div>
</div>

<h2>üè† RealPlot Connect ‚Äì View Properties</h2>
<div id="listings"></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDLTAd2u0IlhA4Gm4-0tTSzLUDHFYj045g",
    authDomain: "realestate-afbe6.firebaseapp.com",
    databaseURL: "https://realestate-afbe6-default-rtdb.firebaseio.com",
    projectId: "realestate-afbe6",
    storageBucket: "realestate-afbe6.appspot.com",
    messagingSenderId: "202970291965",
    appId: "1:202970291965:web:baaf253d6c9a8685c5e894"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let currentUserLatLng = null;

  navigator.geolocation.getCurrentPosition(
    pos => {
      currentUserLatLng = L.latLng(pos.coords.latitude, pos.coords.longitude);
    },
    () => alert("Location access denied.")
  );

  function loadListings() {
    const filterType = document.getElementById("filterType").value;
    const filterLocation = document.getElementById("filterLocation").value;
    const minPrice = parseInt(document.getElementById("minPrice").value) || 0;
    const maxPrice = parseInt(document.getElementById("maxPrice").value) || Infinity;

    db.ref("listings").once("value", snapshot => {
      const data = snapshot.val();
      const listingsDiv = document.getElementById("listings");
      listingsDiv.innerHTML = "";

      if (!data) {
        listingsDiv.innerHTML = "<p>No listings found.</p>";
        return;
      }

      for (let id in data) {
        const item = data[id];
        if (
          (filterType && item.type !== filterType) ||
          (filterLocation && item.location !== filterLocation) ||
          (item.price < minPrice || item.price > maxPrice)
        ) continue;

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <p><strong>Type:</strong> ${item.type}</p>
          <p><strong>Location:</strong> ${item.location}</p>
          <p><strong>Price:</strong> KES ${item.price}</p>
          <p>${item.description}</p>
          <p><strong>Contact:</strong> ${item.contact}</p>
        `;

        if (item.images && item.images.length > 0) {
          item.images.forEach(url => {
            const img = document.createElement("img");
            img.src = url;
            img.className = "property";
            card.appendChild(img);
          });
        }

        const mapId = "map-" + id;
        const btn = document.createElement("button");
        btn.textContent = "üìç Show Directions";
        btn.onclick = () => showMapForListing(item.lat, item.lng, mapId);

        const mapDiv = document.createElement("div");
        mapDiv.id = mapId;

        card.appendChild(btn);
        card.appendChild(mapDiv);
        listingsDiv.appendChild(card);
      }
    });
  }

  function showMapForListing(destLat, destLng, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";

    const mapDiv = document.createElement("div");
    mapDiv.style.height = "300px";
    mapDiv.style.marginTop = "10px";
    mapDiv.style.borderRadius = "10px";
    container.appendChild(mapDiv);

    const directionsList = document.createElement("div");
    directionsList.className = "directions-text";
    directionsList.style.marginTop = "10px";
    directionsList.style.padding = "10px";
    directionsList.style.background = "#f9f9f9";
    directionsList.style.borderRadius = "8px";
    directionsList.innerHTML = "<strong>Directions:</strong><br><em>Loading...</em>";
    container.appendChild(directionsList);

    const map = L.map(mapDiv).setView([destLat, destLng], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    if (!currentUserLatLng) {
      alert("Please allow location access to show directions.");
      return;
    }

    L.marker([destLat, destLng]).addTo(map).bindPopup("Listing Location").openPopup();

    const control = L.Routing.control({
      waypoints: [currentUserLatLng, L.latLng(destLat, destLng)],
      routeWhileDragging: false,
      addWaypoints: false,
      createMarker: () => null,
      show: false,
      lineOptions: {
        styles: [{ color: 'blue', weight: 4, opacity: 0.8 }]
      }
    }).addTo(map);

    control.on('routesfound', function (e) {
      const routes = e.routes[0];
      let steps = "<strong>Directions:</strong><br>";
      routes.instructions = routes.instructions || [];

      routes.instructions = routes.instructions.length > 0
        ? routes.instructions
        : L.Routing.Formatter.prototype._getInstructions.call({options: {}}, routes);

      for (const instr of routes.instructions) {
        if (instr.text) steps += `‚Üí ${instr.text}<br>`;
      }

      steps += `<br><em>Distance:</em> ${(routes.summary.totalDistance / 1000).toFixed(2)} km<br>`;
      steps += `<em>Estimated Time:</em> ${(routes.summary.totalTime / 60).toFixed(0)} mins`;
      directionsList.innerHTML = steps;
    });
  }

  window.onload = loadListings;
</script>

</body>
</html>
