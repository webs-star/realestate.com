<!DOCTYPE html>
<html>
<head>
  <title>Agora Meeting Room</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #video-area { display: flex; justify-content: center; margin-top: 20px; }
    video, div#remote-player { width: 300px; height: 250px; border: 2px solid #000; margin: 5px; }
    #login, #meeting-section { margin-top: 20px; }
  </style>
</head>
<body>

  <h1>🎥 Elimu Connect Meeting Room</h1>

  <!-- 🔐 Login Section -->
  <div id="login">
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="login()">Login</button>
    <p id="login-status"></p>
  </div>

  <!-- 📺 Meeting UI -->
  <div id="meeting-section" style="display:none;">
    <input id="meetingName" placeholder="Enter meeting name" />
    <button onclick="startMeeting()">Start / Join</button>

    <div id="video-area">
      <div id="local-player"></div>
      <div id="remote-player"></div>
    </div>
  </div>

  <script>
    // --- Firebase Init ---
    const firebaseConfig = {
      apiKey: "AIzaSyAYztz7z8L3SFOZgCpbwthzTXeuhojDisM",
      authDomain: "lead-tracker-a2181.firebaseapp.com",
      databaseURL: "https://lead-tracker-a2181-default-rtdb.firebaseio.com",
      projectId: "lead-tracker-a2181",
      storageBucket: "lead-tracker-a2181.appspot.com",
      messagingSenderId: "601818438359",
      appId: "1:601818438359:web:44f4c05db3d732d29dee92"
    };
    firebase.initializeApp(firebaseConfig);

    // --- Login Function ---
    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      firebase.auth().signInWithEmailAndPassword(email, password)
        .then(() => {
          document.getElementById("login").style.display = "none";
          document.getElementById("meeting-section").style.display = "block";
        })
        .catch((error) => {
          document.getElementById("login-status").innerText = "Login failed: " + error.message;
        });
    }

    // --- Agora Init ---
    const APP_ID = "190f79bf2b5c416d9348410849b13076";
    const client = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
    let localStream;

    async function startMeeting() {
      const user = firebase.auth().currentUser;
      const meeting = document.getElementById("meetingName").value.trim();
      if (!meeting || !user) return alert("Enter meeting name and login first.");

      await client.init(APP_ID);
      const uid = user.uid;

      await client.join(APP_ID, meeting, null, (uid) => {
        localStream = AgoraRTC.createStream({ audio: true, video: true });
        localStream.init(() => {
          localStream.play("local-player");
          client.publish(localStream);
        });

        // Log participation
        firebase.database().ref("meetings/" + meeting + "/participants").push({
          name: user.email,
          time: new Date().toLocaleString()
        });

        client.on("stream-added", evt => {
          client.subscribe(evt.stream);
        });

        client.on("stream-subscribed", evt => {
          evt.stream.play("remote-player");
        });
      });
    }
  </script>
</body>
</html>












