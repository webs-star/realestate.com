<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Custom Video Meeting</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <style>
    video { width: 45%; margin: 5px; background: #000; }
    #chat { height:150px; overflow:auto; border:1px solid #ccc; padding:5px; }
  </style>
</head>
<body>
  <h2>ðŸ“§ Login with Email</h2>
  <input id="email" placeholder="Enter Email"><br>
  <input id="password" type="password" placeholder="Enter Password"><br>
  <button onclick="login()">Login</button>
  <button onclick="signup()">Sign Up</button>
  <button onclick="logout()">Logout</button>

  <div id="meetControls" style="display:none">
    <h2>ðŸ”‘ Create/Join Meeting</h2>
    <input id="meetName" placeholder="Meeting Name">
    <button onclick="createMeeting()">Create</button>
    <button onclick="joinMeeting()">Join</button>
  </div>

  <h2>ðŸŽ¥ Video Area</h2>
  <video id="localVid" autoplay muted></video>
  <video id="remoteVid" autoplay></video>

  <h2>ðŸ’¬ Chat</h2>
  <div id="chat"></div>
  <input id="chatMsg" placeholder="Type and hit Enter">

<script>
  // --- Firebase init ---
  const firebaseConfig = {
    apiKey: "AIzaSyAYztz7z8L3SFOZgCpbwthzTXeuhojDisM",
    authDomain: "lead-tracker-a2181.firebaseapp.com",
    databaseURL: "https://lead-tracker-a2181-default-rtdb.firebaseio.com",
    projectId: "lead-tracker-a2181",
    storageBucket: "lead-tracker-a2181.appspot.com",
    messagingSenderId: "601818438359",
    appId: "1:601818438359:web:44f4c05db3d732d29dee92"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // --- Email Auth ---
  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    firebase.auth().signInWithEmailAndPassword(email, password)
      .then(() => {
        alert("Logged in");
        document.getElementById('meetControls').style.display = 'block';
      })
      .catch(err => alert("Login failed: " + err.message));
  }

  function signup() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    firebase.auth().createUserWithEmailAndPassword(email, password)
      .then(() => {
        alert("User created. You can now log in.");
      })
      .catch(err => alert("Signup failed: " + err.message));
  }

  function logout() {
    firebase.auth().signOut().then(() => {
      alert("Logged out");
      document.getElementById('meetControls').style.display = 'none';
    });
  }

  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      document.getElementById('meetControls').style.display = 'block';
    } else {
      document.getElementById('meetControls').style.display = 'none';
    }
  });

  // --- PeerJS for Video ---
  let localStream, peer, conn, callRef;
  navigator.mediaDevices.getUserMedia({video:true,audio:true})
    .then(s => { localStream = s; document.getElementById('localVid').srcObject = s; });

  function createPeerCallback(meetName){
    peer = new Peer(meetName, { debug: 1 });
    peer.on('open', id => {
      peer.on('call', call => {
        call.answer(localStream);
        call.on('stream', remote => document.getElementById('remoteVid').srcObject = remote);
      });
      setupMeeting(meetName);
    });
  }

  function createMeeting(){
    const m = document.getElementById('meetName').value;
    if (!m) return alert('Add meeting name');
    createPeerCallback(m);
  }

  function joinMeeting(){
    const m = document.getElementById('meetName').value;
    if (!m) return alert('Add meeting name');
    peer = new Peer({ debug: 1 });
    peer.on('open', id => {
      const call = peer.call(m, localStream);
      call.on('stream', r => document.getElementById('remoteVid').srcObject = r);
      callRef = call;
      setupMeeting(m);
    });
  }

  // --- Logging and Chat ---
  function setupMeeting(meetName){
    const user = firebase.auth().currentUser;
    if (!user) return alert("User not authenticated.");

    const uid = user.uid;
    db.ref(`meetings/${meetName}/logs`).push({ uid, at: Date.now() });

    const chatRef = db.ref(`meetings/${meetName}/chat`);
    chatRef.on('child_added', snap => {
      const { uid: u, text } = snap.val();
      const div = document.createElement('div');
      div.textContent = `${u}: ${text}`;
      document.getElementById('chat').appendChild(div);
    });

    document.getElementById('chatMsg').addEventListener('keypress', e => {
      if (e.key === 'Enter') {
        const txt = e.target.value;
        chatRef.push({ uid, text: txt, at: Date.now() });
        e.target.value = '';
      }
    });
  }
</script>
</body>
</html>














